<!DOCTYPE html>
<html>
<head>    
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link rel="stylesheet" class="codestyle" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/vs.min.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <style>
        body .row { margin-top: 15px; }
        pre {
            white-space: pre-wrap;
            white-space: -moz-pre-wrap;
            white-space: -pre-wrap;
            white-space: -o-pre-wrap;
            word-wrap: break-word;
        }
        code.markdown {
            font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";
            font-size: 16px;
            line-height: 1.5;
            background-color: inherit;
        }
        code.markdown .h1 {
            padding-bottom: 0.3em;
            font-size: 2em;
        }
        code.hljs { padding: unset; }
	</style>
</head>
<body>
	<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
		<a class="navbar-brand" href="#">
			<img src="https://demos.devexpress.com/favicon.ico" width="30" height="30" class="d-inline-block align-top" alt="">
		</a>
        <a class="btn btn-primary" href='https://github.com/DevExpress-Examples/how-to-show-aspxloadingpanel-during-export-e2293'>Back to repository</a>
        <a class='btn btn-primary mx-auto' href='https://codecentral.devexpress.com/e2293/'>Online example</a>
        <a class="btn btn-success" href='https://github.com/DevExpress-Examples/how-to-show-aspxloadingpanel-during-export-e2293/archive/17.2.4+.zip'>Download example</a>
    </nav>
    <div class='container-fluid'>
        <div class="row">
          <div class="col-sm-2 col-0">
            <div class="list-group" id="list-tab" role="tablist">
               <a class='list-group-item list-group-item-action active' id='list-readme-list' data-toggle='list' href='#readme' role='tab' aria-controls='reame'>Readme</a>
<a class='list-group-item list-group-item-action' id='list-Defaultaspx-list' data-toggle='list' href='#Defaultaspx' role='tab' aria-controls='Defaultaspx'>Default.aspx</a> <a class='list-group-item list-group-item-action' id='list-Defaultaspxcs-list' data-toggle='list' href='#Defaultaspxcs' role='tab' aria-controls='Defaultaspxcs'>Default.aspx.cs</a>
            </div>
            </div>
              <div class="col-sm-10 col-12">
                <div class="tab-content" id="nav-tabContent">
                <div class='tab-pane fade show active' id='readme' role='tabpanel' aria-labelledby='list-readme-list'>
                 <pre><code class='md'># How to show ASPxLoadingPanel during export


<p>When you export a grid with a lage amount of data, you might want to show the ASPxLoadingPanel during exporting. Generally, it is possible to show the LoadingPanel when you start the exporting process. However, you will not be able to determine the moment when it should be hidden, since none of events are generated at the client side when the exporting result is shown...</p><p>This example illustrates how to overcome this limit by using the asp:UpdatePanel. To get the desired result, we've used the <a href="http://msdn.microsoft.com/en-us/library/bb311028.aspx"><u>Sys.WebForms.PageRequestManager</u></a> Class. The Sys.WebForms.PageRequestManager endRequest event is raised after an asynchronous postback is finished and the control has been returned to the browser. Therefore, it is possible to hide the LoadingPanel  in the endRequest event handler. However, when an export button inside the asp:UpdatePane is being clicked, its postback is transformed in an ajax callback. The problem is that when you use ajax you can't continue using the Response.Write, because Ajax doesn't write the entire page, but only some of its parts. So, it is necessary to keep data exported to a stream in the Session. Then you can send a postback to the server side and show the save dialog without ajax.</p><p><strong>Note:</strong> If ASPxGridView exports data for more than 90 seconds, it is necessary to increase the value of the <a href="http://msdn.microsoft.com/en-us/library/system.web.ui.scriptmanager.asyncpostbacktimeout.aspx"><u>ScriptManager.AsyncPostBackTimeout</u></a> property. This allows you to avoid the "The server request timed out" error during export.</p><p><strong>See Also:</strong> <br />
<a href="https://www.devexpress.com/Support/Center/p/E1442">How to use the ASPxLoadingPanel as a progress indicator for AJAX UpdatePanel</a> <br />
<a href="https://www.devexpress.com/Support/Center/p/E5176">GridView - How to show LoadingPanel during export</a></p>

<br/>


 </code></pre>
                 </div>
<div class='tab-pane fade' id='Defaultaspx' role='tabpanel' aria-labelledby='list-Defaultaspx-list'>
                <pre><code class='aspx'>&lt;%@ Page Language="C#" AutoEventWireup="true" CodeFile="Default.aspx.cs" Inherits="_Default" %&gt;

&lt;%@ Register Assembly="DevExpress.Web.v17.2, Version=17.2.4.0, Culture=neutral, PublicKeyToken=b88d1754d700e49a"
    Namespace="DevExpress.Web" TagPrefix="dx" %&gt;



&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"&gt;
&lt;html xmlns="http://www.w3.org/1999/xhtml"&gt;
&lt;head runat="server"&gt;
    &lt;title&gt;How to show ASPxLoadingPanel during export&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;form id="form1" runat="server"&gt;
        &lt;div&gt;
            &lt;dx:ASPxGridViewExporter ID="gridExporter" runat="server"&gt;
            &lt;/dx:ASPxGridViewExporter&gt;
            &lt;dx:ASPxGridView ID="grid" runat="server" EnableCallbackAnimation="true"&gt;
            &lt;/dx:ASPxGridView&gt;
            &lt;asp:ScriptManager ID="ScriptManager1" runat="server"&gt;
            &lt;/asp:ScriptManager&gt;
            &lt;script type="text/javascript"&gt;
                var prm = Sys.WebForms.PageRequestManager.getInstance();
                prm.add_initializeRequest(prm_InitializeRequest);
                prm.add_endRequest(prm_EndRequest);
                function prm_InitializeRequest(sender, args) {
                    panel.Show();
                }
                function prm_EndRequest(sender, args) {
                    panel.Hide();
                    btn.DoClick();
                }
            &lt;/script&gt;
            &lt;dx:ASPxButton ID="btn" runat="server" ClientInstanceName="btn" ClientVisible="false"
                OnClick="btn_Click" /&gt;
            &lt;asp:UpdatePanel ID="UpdatePanel1" runat="server"&gt;
                &lt;ContentTemplate&gt;
                    &lt;dx:ASPxButton ID="bnExportPDF" runat="server" Text="export to PDF" OnClick="bnExport_Click"&gt;
                    &lt;/dx:ASPxButton&gt;
                    &lt;dx:ASPxButton ID="bnExportXLS" runat="server" Text="export to XLS" OnClick="bnExport_Click"&gt;
                    &lt;/dx:ASPxButton&gt;
                    &lt;dx:ASPxButton ID="bnExportRRF" runat="server" Text="export to RTF" OnClick="bnExport_Click"&gt;
                    &lt;/dx:ASPxButton&gt;
                &lt;/ContentTemplate&gt;
            &lt;/asp:UpdatePanel&gt;
            &lt;dx:ASPxLoadingPanel ID="panel" ClientInstanceName="panel" runat="server" Modal="true"&gt;
            &lt;/dx:ASPxLoadingPanel&gt;
        &lt;/div&gt;
    &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
 </code></pre>
                </div> <div class='tab-pane fade' id='Defaultaspxcs' role='tabpanel' aria-labelledby='list-Defaultaspxcs-list'>
                <pre><code class='cs'>using System;
using System.Data;
using System.Web;
using System.IO;
using DevExpress.Web;
using DevExpress.XtraPrinting;
using DevExpress.XtraPrintingLinks;

public partial class _Default : System.Web.UI.Page {
    protected void Page_Init(object sender, EventArgs e) {
        grid.AutoGenerateColumns = true;
        grid.Width = 400;
        grid.Settings.HorizontalScrollBarMode = ScrollBarMode.Auto;
        grid.SettingsExport.EnableClientSideExportAPI = true;
        grid.DataSource = GetDataTable();
        grid.DataBind();
    }
    private DataTable GetDataTable() {
        DataTable dt = new DataTable();
        dt.Columns.Add("NumberID", System.Type.GetType("System.Int32"));
        for(int i = 0; i &lt; 10; i++) {
            dt.Columns.Add("Number" + i, System.Type.GetType("System.Int32"));
        }
        dt.PrimaryKey = new DataColumn[] { dt.Columns["NumberID"] };
        for(int i = 0; i &lt; 1000; i++) {
            dt.Rows.Add(i, i, i, i, i, i, i, i, i, i, i);
        }
        return dt;
    }
    protected void bnExport_Click(object sender, EventArgs e) {
        ASPxButton btn = sender as ASPxButton;

        PrintingSystemBase ps = new PrintingSystemBase();
        PrintableComponentLinkBase lnk = new PrintableComponentLinkBase(ps);
        lnk.Component = gridExporter;

        CompositeLinkBase compositeLink = new CompositeLinkBase(ps);
        compositeLink.Links.AddRange(new object[] { lnk });
        compositeLink.CreateDocument();

        MemoryStream stream = new MemoryStream();
        string type = string.Empty;
        switch(btn.ID) {
            case "bnExportPDF":
                compositeLink.PrintingSystemBase.ExportToPdf(stream);
                type = "pdf";
                break;
            case "bnExportXLS":
                compositeLink.PrintingSystemBase.ExportToXls(stream);
                type = "xls";
                break;
            case "bnExportRRF":
                compositeLink.PrintingSystemBase.ExportToRtf(stream);
                type = "rtf";
                break;
        }
        Session["ExportStreame"] = stream;
        Session["type"] = type;
    }
    protected void btn_Click(object sender, EventArgs e) {
        MemoryStream stream = Session["ExportStreame"] as MemoryStream;
        string type = Session["type"].ToString();
        WriteToResponse(grid.ID, true, type, stream);
    }
    protected void WriteToResponse(string fileName, bool saveAsFile, string fileFormat, MemoryStream stream) {
        if(Page == null || Page.Response == null) return;
        string disposition = saveAsFile ? "attachment" : "inline";
        Page.Response.Clear();
        Page.Response.Buffer = false;
        Page.Response.AppendHeader("Content-Type", string.Format("application/{0}", fileFormat));
        Page.Response.AppendHeader("Content-Transfer-Encoding", "binary");
        Page.Response.AppendHeader("Content-Disposition", string.Format("{0}; filename={1}.{2}", disposition, HttpUtility.UrlEncode(fileName).Replace("+", "%20"), fileFormat));
        Page.Response.BinaryWrite(stream.ToArray());
        Page.Response.End();
    }
}
 </code></pre>
                </div>
            </div>
          </div>
        </div>
    </div>



<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
<script>
    fetch('https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js')
        .then(response => response.text())
        .then(text => {
            eval(text); 
            jQuery('pre code').each(function(i, block) {
                hljs.highlightBlock(block);
                let h1Ele = jQuery('code.markdown span:contains("# ")');
                if (h1Ele.length > 0)
                    h1Ele.text(h1Ele.text().slice(2)).addClass('h1');
              });
        });
</script>
</body>
</html>
